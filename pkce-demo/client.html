 <!--Résumé clair de ton code

User tape username/password

JS lit ces valeurs dans des variables

JS génère PKCE (random → verifier → hash → challenge)

JS stocke verifier dans sessionStorage

JS affiche les valeurs dans <pre id="output"> -->




<!DOCTYPE html>
<html lang="fr">

 <!-- Partie non visible : meta, titre, style, etc -->
<head>
  <meta charset="UTF-8" />

  <title>Client Page (PKCE)</title>      <!-- Titre onglet navigateur -->
  




  <style>        /* DÉBUT DU CSS INTERNE (MISE EN FORME SIMPLE) */
   
    body { 
      font-family: sans-serif;                                                    /* Police facile à lire */
      margin: 30px;                                                               /* Espace autour du contenu */
    }

    input { 
      display:block;                                                              /* Chaque input prend une ligne entière */
      margin: 8px 0;                                                              /* Espace vertical entre inputs */
      padding:6px;                                                                /* Un peu d’espace dans la case */
      width: 250px;                                                               /* Largeur fixe */
    }

    pre { 
      background:#f4f4f4;                                                        /* Fond gris clair */
      padding:10px;                                                                /* Marge interne */
    }

  </style>        <!-- Fin du CSS -->
  
</head>





<!-- CONTENU VISIBLE -->
<body>

  <h1>Page Client (simule Google)</h1>                                          <!-- Titre principal -->


  <form id="loginForm">       <!-- Formulaire HTML -->
    
    <label>Username</label>                                                      <!--USERNAME -->
    <input id="username" required />
                                                                                                                            <!-- Champ texte pour username
                                                                                                                            required = obligatoire -->
    <label>Password</label>                                                      <!-- PASSWORD -->
    <input id="password" type="password" required />
                                                                                                                                <!-- Champ mot de passe masqué
                                                                                                                                    required = obligatoire -->
    <button type="submit">Login</button>                                         <!-- ENVOI du formulaire -->
                                                                                                                                  <!-- Bouton qui déclenche l’envoi du formulaire -->


  </form>                     <!-- Fin du formulaire -->
 






  <h2>Résultat PKCE</h2>            <!-- Titre secondaire -->
  

  <pre id="output">Rien pour l'instant.</pre>
                                                                <!-- Zone où on affichera code_verifier + code_challenge
                                                                    pre = garde les retours à la ligne -->





  <script>           // Début du JavaScript
   

    // --- Utils PKCE ---
    // Fonctions utilitaires nécessaires pour PKCE

    function base64urlencode(arrayBuffer) {                                                 // Transforme un ArrayBuffer (binaire) en Base64 "URL safe"
      const bytes = new Uint8Array(arrayBuffer);                                         // Convertit l’ArrayBuffer en tableau d’octets                  
      let binary = "";                                                                 // Chaîne vide pour accumuler les caractères 
      bytes.forEach(b => binary += String.fromCharCode(b));                          // Convertit chaque octet en caractère et l’ajoute à la chaîne                                                       
      return btoa(binary)                                                           // btoa() encode en base64 classique
        .replace(/\+/g, "-")                                                              // Remplace + par -                           
        .replace(/\//g, "_")                                                             // Remplace / par _
        .replace(/=+$/, "");                                                               // Supprime les = à la fin
    }

    function randomString(length = 64) {                                       // Génère une chaîne aléatoire sécurisée
                                                                               // length = 64 par défaut
      const array = new Uint8Array(length);                                   // Tableau de 64 octets
      crypto.getRandomValues(array);                                          // Remplit ce tableau avec des valeurs aléatoires cryptographiques
                                                                            // C’est le truc le plus sécurisé côté navigateur
      return base64urlencode(array);                                          // Encode ces octets en Base64 URL safe → code_verifier
    }

    async function sha256(plain) {                                        // Hash SHA-256 d’une chaîne "plain"
      const encoder = new TextEncoder();                                     // Outil pour convertir une string en bytes
      const data = encoder.encode(plain);                                        // Convertit plain en tableau de bytes
      return await crypto.subtle.digest("SHA-256", data);                       // Applique SHA-256, retourne un ArrayBuffer
    }

    async function generatePKCE() {     // Fonction principale PKCE

      const code_verifier = randomString(64);                                    // Génère un code verifier random
      const hashed = await sha256(code_verifier);                                // Hash SHA-256 du verifier
      const code_challenge = base64urlencode(hashed);                            // Encode le hash en Base64 URL safe
     

      return { code_verifier, code_challenge }; // Renvoie les deux valeurs
                                                                     
    }  




    // --- Form handler ---
    // Gestion du formulaire

    document.getElementById("loginForm").addEventListener("submit", async (e) => {    // Quand on clique sur Login → déclenche cet event
  e.preventDefault();                                                             // Empêche la page de se recharger automatiquement

  const username = document.getElementById("username").value;                     // Récupère ce que l'utilisateur a tapé en username
  const password = document.getElementById("password").value;                     // Récupère le password tapé

  const { code_verifier, code_challenge } = await generatePKCE();                 // Génère verifier + challenge (PKCE)
  sessionStorage.setItem("code_verifier", code_verifier);                         // Stocke le verifier dans sessionStorage (temporaire)
  console.log("verifier stocké =", sessionStorage.getItem("code_verifier"));      // Affiche dans la console du navigateur pour debug

  let authzResponse = null;                                                       // Variable qui va contenir la réponse du serveur

  try {
    const res = await fetch("http://localhost:5000/authorize", {                  // Envoie une requête POST vers l'AuthZServer
      method: "POST",                                                             // Méthode HTTP = POST
      headers: { "Content-Type": "application/json" },                            // On précise que le corps de la requête est du JSON
      body: JSON.stringify({ code_challenge })                                    // On envoie le challenge dans le body JSON
    });

    authzResponse = await res.json();                                             // Convertit la réponse du serveur en JSON
  } catch (err) {
    authzResponse = { error: "fetch_failed", details: String(err) };             // Si problème (CORS, serveur off, etc.) → message d'erreur
  }

  document.getElementById("output").textContent =                                 // On écrit toute la sortie dans le <pre id="output">
    "username: " + username + "\n" +                                               // Affiche le username
    "password: " + "*".repeat(password.length) + "\n\n" +                          // Affiche des étoiles à la place du mot de passe
    "code_verifier:\n" + code_verifier + "\n\n" +                                  // Affiche le verifier
    "code_challenge:\n" + code_challenge + "\n\n" +                                // Affiche le challenge
    "Réponse AuthZServer:\n" + JSON.stringify(authzResponse, null, 2);             // Affiche la réponse JSON du serveur (token ou erreur)
});


  </script>
  <!-- Fin du JavaScript -->
</body>
<!-- Fin body -->

</html>
<!-- Fin HTML -->
